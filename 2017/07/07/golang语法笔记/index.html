<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>golang语法笔记 | caster</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">golang语法笔记</h1><a id="logo" href="/.">caster</a><p class="description">点滴积累方有为</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> archives</i></a><a href="/about-me/"><i class="fa fa-user"> about me</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">golang语法笔记</h1><div class="post-meta">Jul 7, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><!-- toc -->
<ul>
<li><a href="#golang-语法笔记">golang 语法笔记</a><ul>
<li><a href="#包-package">包 Package</a><ul>
<li><a href="#包的声明-declare">包的声明 Declare</a></li>
<li><a href="#包的导入-import">包的导入 Import</a></li>
<li><a href="#包内元素的可见性-accessability">包内元素的可见性 Accessability</a></li>
</ul>
</li>
<li><a href="#数据类型-data-type">数据类型 Data Type</a><ul>
<li><a href="#基础数据类型-basic-data-type">基础数据类型 Basic data type</a><ul>
<li><a href="#变量-variable">变量 Variable</a></li>
<li><a href="#常量-constant">常量 Constant</a></li>
<li><a href="#自动递增枚举常量-iota">自动递增枚举常量 iota</a></li>
</ul>
</li>
<li><a href="#数组-array">数组 Array</a></li>
<li><a href="#切片-slice">切片 Slice</a></li>
<li><a href="#字典映射-map">字典/映射 Map</a></li>
<li><a href="#结构体-struct">结构体 Struct</a></li>
<li><a href="#指针-pointer">指针 Pointer</a></li>
<li><a href="#通道-channel">通道 Channel</a></li>
<li><a href="#接口-interface">接口 Interface</a></li>
<li><a href="#自定义类型">自定义类型</a></li>
<li><a href="#类型别名go-19">类型别名Go 1.9</a></li>
</ul>
</li>
<li><a href="#语句-statement">语句 Statement</a><ul>
<li><a href="#条件语句-if">条件语句 if</a></li>
<li><a href="#分支选择-switch">分支选择 switch</a></li>
<li><a href="#循环语句-for">循环语句 for</a></li>
<li><a href="#通道选择-select">通道选择 select</a></li>
<li><a href="#延迟执行-defer">延迟执行 defer</a></li>
<li><a href="#跳转语句-goto">跳转语句 goto</a></li>
</ul>
</li>
<li><a href="#函数-function">函数 Function</a><ul>
<li><a href="#函数声明-declare">函数声明 Declare</a></li>
<li><a href="#函数闭包-closure">函数闭包 Closure</a></li>
<li><a href="#内建函数-builtin">内建函数 Builtin</a></li>
</ul>
</li>
<li><a href="#方法-method">方法 Method</a></li>
<li><a href="#并发-concurrency">并发 Concurrency</a></li>
<li><a href="#测试-testing">测试 Testing</a><ul>
<li><a href="#基准测试-benchmark">基准测试 Benchmark</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<a id="more"></a>
<h2><span id="golang-语法笔记">golang 语法笔记</span></h2><h3><span id="包-package">包 Package</span></h3><h4><span id="包的声明-declare">包的声明 Declare</span></h4><p>​    使用package关键字声明当前源文件所在的包</p>
<p>​    包声明语句是所有源文件的第一行非注释语句</p>
<p>​    包名称中不能包含空白字符</p>
<p>​    包名推荐与源文件所在的目录名称保持一致</p>
<p>​    每个目录中只能定义一个package</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cxy     <span class="comment">// 声明一个名为“cxy”的包</span></div><div class="line"><span class="keyword">package</span> 我的包   <span class="comment">// 声明一个名为“我的包”的包</span></div><div class="line"><span class="keyword">package</span> main    <span class="comment">// main包, 程序启动执行的入口包</span></div></pre></td></tr></table></figure>
<p>​    错误的包声明</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> <span class="string">"mypkg"</span> <span class="comment">// 错误</span></div><div class="line"><span class="keyword">package</span> a/b/c   <span class="comment">// 错误</span></div><div class="line">pakcage a.b.c   <span class="comment">// 错误</span></div></pre></td></tr></table></figure>
<h4><span id="包的导入-import">包的导入 Import</span></h4><p>​    导入包路径在 $GOROOT/pkg/$GOOS<em>$GOARCH/ 或 $GOPATH/pkg/$GOOS</em>$GOARCH/</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 导入$GOROOT/$GOOS_$GOARCH/中的相对路径包(官方标准库)</span></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"><span class="keyword">import</span> <span class="string">"math/rand"</span></div><div class="line"><span class="comment">// 导入$GOPATH/$GOOS_$GOARCH/中的相对路径包</span></div><div class="line"><span class="keyword">import</span> <span class="string">"github.com/user/project/pkg"</span></div><div class="line"><span class="keyword">import</span> <span class="string">"code.google.com/p/project/pkg"</span></div></pre></td></tr></table></figure>
<p>​    导入当前包的相对路径包</p>
<p>​    例如有go目录如下：    </p>
<p>$GOPATH/src</p>
<p>　├─x0</p>
<p>　│　├─y0</p>
<p>　│　│　└─z0</p>
<p>　│　└─y1</p>
<p>　│　　└─z1</p>
<p>　└─x1</p>
<p>　　└─y2</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"./y0/z0"</span>    <span class="comment">// x0包中导入子包 z0包</span></div><div class="line"><span class="keyword">import</span> <span class="string">"../y0/z0"</span>   <span class="comment">// y1包中导入子包 z0包</span></div><div class="line"><span class="keyword">import</span> <span class="string">"x0/y1/z1"</span>   <span class="comment">// y2包中导入 z1包</span></div></pre></td></tr></table></figure>
<p>​    错误的导入包路径</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> a/b/c        <span class="comment">// 错误</span></div><div class="line"><span class="keyword">import</span> <span class="string">"a.b.c"</span>      <span class="comment">// 错误</span></div><div class="line"><span class="keyword">import</span> a.b.c        <span class="comment">// 错误</span></div></pre></td></tr></table></figure>
<p>​    用圆括号组合导入包路径</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> (<span class="string">"fmt"</span>; <span class="string">"math"</span>)</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"math"</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>​    导入包可以定义别名，防止同名称的包冲突</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"a/b/c"</span></div><div class="line">    c1 <span class="string">"x/y/c"</span>     <span class="comment">// 将导入的包c定义别名为 c1</span></div><div class="line">    格式化 <span class="string">"fmt"</span>    <span class="comment">// 将导入的包fmt定义别名为 格式化</span></div><div class="line">    m <span class="string">"math"</span>       <span class="comment">// 将导入的包math定义别名为 m</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>​    引用包名是导入包路径的最后一个目录中定义的唯一包的名称</p>
<p>​    定义的包名与目录同名时，直接引用即可</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引用普通名称的导入包</span></div><div class="line">c.hello()</div><div class="line"><span class="comment">// 引用定义别名的包</span></div><div class="line">格式化.Println(m.Pi)</div></pre></td></tr></table></figure>
<p>​    定义的包名与所在目录名称不同时，导入包路径仍为目录所在路径，引用包名为定义的包名称</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 源文件路径: $GOPATH/src/proj/my-util/util.go</span></div><div class="line"><span class="comment">// 定义包名: util</span></div><div class="line"><span class="keyword">package</span> util</div><div class="line"><span class="comment">// 导入util包路径</span></div><div class="line"><span class="keyword">import</span> <span class="string">"proj/my-util"</span></div><div class="line"><span class="comment">// 引用util包</span></div><div class="line">util.doSomething()</div></pre></td></tr></table></figure>
<p>静态导入，在导入的包路径之前增加一个小数点.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//类似C中的include 或Java中的import static</span></div><div class="line"><span class="keyword">import</span> . <span class="string">"fmt"</span></div><div class="line"><span class="comment">// 然后像使用本包元素一样使用fmt包中可见的元素，不需要通过包名引用</span></div><div class="line">Println(<span class="string">"no need package name"</span>)</div><div class="line">导入包但不直接使用该包，在导入的包路径之前增加一个下划线_</div><div class="line"><span class="comment">// 如果当前go源文件中未引用过log包，将会导致编译错误</span></div><div class="line"><span class="keyword">import</span> <span class="string">"log"</span>    <span class="comment">// 错误</span></div><div class="line"><span class="keyword">import</span> . <span class="string">"log"</span>  <span class="comment">// 静态导入未使用同样报错</span></div><div class="line"><span class="comment">// 在包名前面增加下划线表示导入包但是不直接使用它，被导入的包中的init函数会在导入的时候执行</span></div><div class="line"><span class="keyword">import</span> _ <span class="string">"github.com/go-sql-driver/mysql"</span></div></pre></td></tr></table></figure>
<h4><span id="包内元素的可见性-accessability">包内元素的可见性 Accessability</span></h4><ul>
<li><p>名称首字符为Unicode包含的大写字母的元素是被导出的，对外部包是可见的，</p>
<blockquote>
<p>首字为非大写字母的元素只对本包可见(同包跨源文件可以访问，子包不能访问)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> In <span class="keyword">int</span>                                      <span class="comment">// In is exported</span></div><div class="line"><span class="keyword">var</span> in <span class="keyword">byte</span>                                     <span class="comment">// in is unexported</span></div></pre></td></tr></table></figure>
</li>
<li><p>internal包（内部包）Go 1.4</p>
<blockquote>
<p>internal包及其子包中的导出元素只能被与internal同父包的其他包访问</p>
</blockquote>
<p>例如有Go目录如下：</p>
<p>$GOPATH/src</p>
<p>　├─x0</p>
<p>　│　├─internal</p>
<p>　│　│　└─z0</p>
<p>　│　└─y0</p>
<p>　│　　└─z1</p>
<p>　└─x1</p>
<p>　　└─y1</p>
<p>x0，y0，z1包中可以访问internal，z0包中的可见元素</p>
<p>x1，y1包中不能导入internal，z0包</p>
</li>
<li><p>规范导入包路径Canonical import pathsGo 1.4</p>
<blockquote>
<p>包声明语句后面添加标记注释，用于标识这个包的规范导入路径。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> pdf <span class="comment">// import "rsc.io/pdf"</span></div></pre></td></tr></table></figure>
<p>如果使用此包的代码的导入的路径不是规范路径，go命令会拒绝编译。</p>
<p>例如有 rsc.io/pdf 的一个fork 路径 github.com/rsc/pdf</p>
<p>如下程序代码导入路径时使用了非规范的路径则会被go拒绝编译</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"github.com/rsc/pdf"</span></div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h3><span id="数据类型-data-type">数据类型 Data Type</span></h3><h4><span id="基础数据类型-basic-data-type">基础数据类型 Basic data type</span></h4><p>​    基本类型包含：数值类型，布尔类型，字符串</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>取值范围</th>
<th>默认零值</th>
<th>类型</th>
<th>取值范围</th>
<th>默认零值</th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>int32, int64</td>
<td>0</td>
<td>uint</td>
<td>uint32, uint64</td>
<td>0</td>
</tr>
<tr>
<td>int8</td>
<td>-27~27-1</td>
<td>0</td>
<td>uint8, byte</td>
<td>0 ~ 28-1</td>
<td>0</td>
</tr>
<tr>
<td>int16</td>
<td>-215~215-1</td>
<td>0</td>
<td>uint16</td>
<td>0~216-1</td>
<td>0</td>
</tr>
<tr>
<td>int32,rune</td>
<td>-231~231-1</td>
<td>0</td>
<td>uint32</td>
<td>0~232-1</td>
<td>0</td>
</tr>
<tr>
<td>int64</td>
<td>-263 ~ 263-1</td>
<td>0</td>
<td>uint64</td>
<td>0 ~ 264-1</td>
<td>0</td>
</tr>
<tr>
<td>float32</td>
<td>IEEE-754 32-bit</td>
<td>0.0</td>
<td>float64</td>
<td>IEEE-754 64-bit</td>
<td>0.0</td>
</tr>
<tr>
<td>complex64</td>
<td>float32+float32i</td>
<td>0 + 0i</td>
<td>complex128</td>
<td>float64+float64i</td>
<td>0 + 0i</td>
</tr>
<tr>
<td>bool</td>
<td>true,false</td>
<td>false</td>
<td>string</td>
<td>“” ~ “∞”</td>
<td>“”,``</td>
</tr>
<tr>
<td>uintptr</td>
<td>uint32,uint64</td>
<td>0</td>
<td>error</td>
<td>-</td>
<td>nil</td>
</tr>
</tbody>
</table>
<h5><span id="变量-variable">变量 Variable</span></h5><blockquote>
<p>变量声明, 使用var关键字</p>
</blockquote>
<p>Go中只能使用var 声明变量，无需显式初始化值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i <span class="keyword">int</span>       <span class="comment">// i = 0</span></div><div class="line"><span class="keyword">var</span> s <span class="keyword">string</span>    <span class="comment">// s = ""    (Go中的string是值类型，默认零值是空串 "" 或 ``，不存在nil(null)值)</span></div><div class="line"><span class="keyword">var</span> e error     <span class="comment">// e = nil, error是Go的内建接口类型。</span></div><div class="line"><span class="comment">//关键字的顺序错误或缺少都是编译错误的</span></div><div class="line"><span class="keyword">var</span> <span class="keyword">int</span> a       <span class="comment">// 编译错误</span></div><div class="line">a <span class="keyword">int</span>           <span class="comment">// 编译错误</span></div><div class="line"><span class="keyword">int</span> a           <span class="comment">// 编译错误</span></div></pre></td></tr></table></figure>
<p>var 语句可以声明一个变量列表，类型在变量名之后</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a,b,c <span class="keyword">int</span>   <span class="comment">// a = 0, b = 0, c = 0</span></div><div class="line"><span class="keyword">var</span> (</div><div class="line">    a <span class="keyword">int</span>       <span class="comment">// a = 0</span></div><div class="line">    b <span class="keyword">string</span>    <span class="comment">// b = ""</span></div><div class="line">    c <span class="keyword">uint</span>      <span class="comment">// c = 0</span></div><div class="line">)</div><div class="line"><span class="keyword">var</span> (</div><div class="line">    a,b,c <span class="keyword">int</span></div><div class="line">    d <span class="keyword">string</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>变量定义时初始化赋值，每个变量对应一个值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">0</span></div><div class="line"><span class="keyword">var</span> a, b <span class="keyword">int</span> = <span class="number">0</span>, <span class="number">1</span></div></pre></td></tr></table></figure>
<p>变量定义并初始化时可以省略类型，Go自动根据初始值推导变量的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="string">'A'</span>         <span class="comment">// a int32</span></div><div class="line"><span class="keyword">var</span> a,b = <span class="number">0</span>, <span class="string">"B"</span>    <span class="comment">// a int, b string</span></div></pre></td></tr></table></figure>
<p>使用组合符号:=定义并初始化变量，根据符号右边表达式的值的类型声明变量并初始化它的值</p>
<p>:= 不能在函数外使用，函数外的每个语法块都必须以关键字开始</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a := <span class="number">3</span>                     <span class="comment">// a int</span></div><div class="line">a, b, c := <span class="number">8</span>, <span class="string">'呴'</span>, <span class="literal">true</span>   <span class="comment">// a int, b int32, c bool</span></div><div class="line">c := <span class="string">`formatted</span></div><div class="line"><span class="string"> string`</span>                   <span class="comment">// c string</span></div><div class="line">c := <span class="number">1</span> + <span class="number">2i</span>                <span class="comment">// c complex128</span></div></pre></td></tr></table></figure>
<h5><span id="常量-constant">常量 Constant</span></h5><p>常量可以是字符、字符串、布尔或数值类型的值，数值常量是高精度的值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> x <span class="keyword">int</span> = <span class="number">3</span></div><div class="line"><span class="keyword">const</span> y,z <span class="keyword">int</span> = <span class="number">1</span>,<span class="number">2</span></div><div class="line"><span class="keyword">const</span> (</div><div class="line">    a <span class="keyword">byte</span> = <span class="string">'A'</span></div><div class="line">    b <span class="keyword">string</span> = <span class="string">"B"</span></div><div class="line">    c <span class="keyword">bool</span> = <span class="literal">true</span></div><div class="line">    d <span class="keyword">int</span> = <span class="number">4</span></div><div class="line">    e <span class="keyword">float32</span> = <span class="number">5.1</span></div><div class="line">    f <span class="keyword">complex64</span> = <span class="number">6</span> + <span class="number">6i</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>根据常量值自动推导类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> a = <span class="number">0</span>        <span class="comment">// a int</span></div><div class="line"><span class="keyword">const</span> (</div><div class="line">    b = <span class="number">2.3</span>        <span class="comment">// b float64</span></div><div class="line">    c = <span class="literal">true</span>       <span class="comment">// c bool</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>常量组内定义时复用表达式</p>
<p>常量组内定义的常量只有名称时，其值会根据上一次最后出现的常量表达式计算相同的类型与值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a = <span class="number">3</span>               <span class="comment">// a = 3</span></div><div class="line">    b                   <span class="comment">// b = 3</span></div><div class="line">    c                   <span class="comment">// c = 3</span></div><div class="line">    d = <span class="built_in">len</span>(<span class="string">"asdf"</span>)     <span class="comment">// d = 4</span></div><div class="line">    e                   <span class="comment">// e = 4</span></div><div class="line">    f                   <span class="comment">// f = 4</span></div><div class="line">    g,h,i = <span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>       <span class="comment">// 复用表达式要一一对应</span></div><div class="line">    x,y,z               <span class="comment">// x = 7, y = 8, z = 9</span></div><div class="line">)</div></pre></td></tr></table></figure>
<h5><span id="自动递增枚举常量-iota">自动递增枚举常量 iota</span></h5><p>iota的枚举值可以赋值给数值兼容类型</p>
<p>每个常量单独声明时，iota不会自动递增</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> a <span class="keyword">int</span> = <span class="literal">iota</span>        <span class="comment">// a = 0</span></div><div class="line"><span class="keyword">const</span> b <span class="keyword">int</span> = <span class="literal">iota</span>        <span class="comment">// b = 0</span></div><div class="line"><span class="keyword">const</span> c <span class="keyword">byte</span> = <span class="literal">iota</span>       <span class="comment">// c = 0</span></div><div class="line"><span class="keyword">const</span> d <span class="keyword">uint64</span> = <span class="literal">iota</span>     <span class="comment">// d = 0</span></div></pre></td></tr></table></figure>
<p>常量组合声明时，iota每次引用会逐步自增，初始值为0，步进值为1</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a <span class="keyword">uint8</span> = <span class="literal">iota</span>        <span class="comment">// a = 0</span></div><div class="line">    b <span class="keyword">int16</span> = <span class="literal">iota</span>        <span class="comment">// b = 1</span></div><div class="line">    c <span class="keyword">rune</span> = <span class="literal">iota</span>         <span class="comment">// c = 2</span></div><div class="line">    d <span class="keyword">float64</span> = <span class="literal">iota</span>      <span class="comment">// d = 3</span></div><div class="line">    e <span class="keyword">uintptr</span> = <span class="literal">iota</span>      <span class="comment">// e = 4</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>即使iota不是在常量组内第一个开始引用，也会按组内常量数量递增</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a = <span class="string">"A"</span></div><div class="line">    b = <span class="string">'B'</span></div><div class="line">    c = <span class="literal">iota</span>    <span class="comment">// c = 2</span></div><div class="line">    d = <span class="string">"D"</span></div><div class="line">    e = <span class="literal">iota</span>    <span class="comment">// e = 4</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>枚举的常量都为同一类型时，可以使用简单序列格式(组内复用表达式).</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a = <span class="literal">iota</span>     <span class="comment">// a int32 = 0</span></div><div class="line">    b            <span class="comment">// b int32 = 1</span></div><div class="line">    c            <span class="comment">// c int32 = 2</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>枚举序列中的未指定类型的常量会跟随序列前面最后一次出现类型定义的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a <span class="keyword">byte</span> = <span class="literal">iota</span>    <span class="comment">// a uint8 = 0</span></div><div class="line">    b                <span class="comment">// b uint8 = 1</span></div><div class="line">    c                <span class="comment">// c uint8 = 2</span></div><div class="line">    d <span class="keyword">rune</span> = <span class="literal">iota</span>    <span class="comment">// d int32 = 3</span></div><div class="line">    e                <span class="comment">// e int32 = 4</span></div><div class="line">    f                <span class="comment">// f int32 = 5</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>iota自增值只在一个常量定义组合中有效，跳出常量组合定义后iota初始值归0</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a = <span class="literal">iota</span>     <span class="comment">// a int32 = 0</span></div><div class="line">    b            <span class="comment">// b int32 = 1</span></div><div class="line">    c            <span class="comment">// c int32 = 2</span></div><div class="line">)</div><div class="line"><span class="keyword">const</span> (</div><div class="line">    e = <span class="literal">iota</span>     <span class="comment">// e int32 = 0    (iota重新初始化并自增)</span></div><div class="line">    f            <span class="comment">// f int32 = 1</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>定制iota序列初始值与步进值 (通过组合内复用表达式实现)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    a = (<span class="literal">iota</span> + <span class="number">2</span>) * <span class="number">3</span>    <span class="comment">// a int32 = 6    (a=(0+2)*3) 初始值为6,步进值为3</span></div><div class="line">    b                     <span class="comment">// b int32 = 9    (b=(1+2)*3)</span></div><div class="line">    c                     <span class="comment">// c int32 = 12    (c=(2+2)*3)</span></div><div class="line">    d                     <span class="comment">// d int32 = 15    (d=(3+2)*3)</span></div><div class="line">)</div></pre></td></tr></table></figure>
<h4><span id="数组-array">数组 Array</span></h4><p>数组声明带有长度信息且长度固定，数组是值类型默认零值不是 nil，传递参数时会进行复制。</p>
<p>声明定义数组时中括号[ ]在类型名称之前，赋值引用元素时中括号[ ]在数组变量名之后。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a [<span class="number">3</span>]<span class="keyword">int</span> = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;                         <span class="comment">// a = [0 1 2]</span></div><div class="line"><span class="keyword">var</span> b [<span class="number">3</span>]<span class="keyword">int</span> = [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;                                <span class="comment">// b = [0 0 0]</span></div><div class="line"><span class="keyword">var</span> c [<span class="number">3</span>]<span class="keyword">int</span></div><div class="line">c = [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</div><div class="line">c = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;                                      <span class="comment">// c = [0 0 0]</span></div><div class="line">d := [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;                                          <span class="comment">// d = [0 0 0]</span></div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, d, d, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d))  <span class="comment">// </span></div><div class="line">[<span class="number">3</span>]<span class="keyword">int</span>  [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;  <span class="number">3</span>    <span class="number">3</span></div></pre></td></tr></table></figure>
<p>使用…自动计算数组的长度</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = [...]<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;</div><div class="line"><span class="comment">// 多维数组只能自动计算最外围数组长度</span></div><div class="line">x := ...<span class="keyword">int</span>&#123;&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;, &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;&#125;</div><div class="line">y := ...[<span class="number">2</span>]<span class="keyword">int</span>&#123;&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">2</span>,<span class="number">3</span>&#125;&#125;,&#123;&#123;<span class="number">4</span>,<span class="number">5</span>&#125;,&#123;<span class="number">6</span>,<span class="number">7</span>&#125;&#125;&#125;</div><div class="line"><span class="comment">// 通过下标访问数组元素</span></div><div class="line"><span class="built_in">println</span>(y1[<span class="number">0</span>])                                    <span class="comment">// 6</span></div></pre></td></tr></table></figure>
<p>初始化指定索引的数组元素，未指定初始化的元素保持默认零值</p>
<p>var a = [3]int{2:3}</p>
<p>var b = […]string{2:”c”, 3:”d”}</p>
<h4><span id="切片-slice">切片 Slice</span></h4><p>slice 切片是对一个数组上的连续一段的引用，并且同时包含了长度和容量信息</p>
<p>因为是引用类型，所以未初始化时的默认零值是nil，长度与容量都是0</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a []<span class="keyword">int</span></div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, a, a, <span class="built_in">len</span>(a), <span class="built_in">cap</span>(a))    </div><div class="line"><span class="comment">// []int    []int(nil)    0    0</span></div><div class="line"><span class="comment">// 可用类似数组的方式初始化slice</span></div><div class="line"><span class="keyword">var</span> d []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;</div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, d, d, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d))    </div><div class="line"><span class="comment">// []int    []int&#123;0, 1, 2&#125;    3    3</span></div><div class="line"><span class="keyword">var</span> e = []<span class="keyword">string</span>&#123;<span class="number">2</span>:<span class="string">"c"</span>, <span class="number">3</span>:<span class="string">"d"</span>&#125;</div></pre></td></tr></table></figure>
<p>使用内置函数make初始化slice，第一参数是slice类型，第二参数是长度，第三参数是容量(省略时与长度相同)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> b = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, b, b, <span class="built_in">len</span>(b), <span class="built_in">cap</span>(b))    <span class="comment">// []int    []int&#123;&#125;    0    0</span></div><div class="line"><span class="keyword">var</span> c = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">10</span>)</div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, c, c, <span class="built_in">len</span>(c), <span class="built_in">cap</span>(c))    <span class="comment">// []int    []int&#123;&#125;    3    10</span></div><div class="line"><span class="keyword">var</span> a = <span class="built_in">new</span>([]<span class="keyword">int</span>)</div><div class="line">fmt.Printf(<span class="string">"%T\t%#v\t%d\t%d\n"</span>, a, a, <span class="built_in">len</span>(*a), <span class="built_in">cap</span>(*a))  <span class="comment">// *[]int    &amp;[]int(nil)    0   0</span></div></pre></td></tr></table></figure>
<p>基于slice或数组重新切片，创建一个新的 slice 值指向相同的数组</p>
<p>重新切片支持两种格式：</p>
<p>2个参数 slice[beginIndex:endIndex]</p>
<p>需要满足条件：0 &lt;= beginIndex &lt;= endIndex &lt;= cap(slice)</p>
<p>截取从开始索引到结束索引-1 之间的片段</p>
<p>新slice的长度：length=(endIndex - beginIndex)</p>
<p>新slice的容量：capacity=(cap(slice) - beginIndex)</p>
<p>beginIndex的值可省略，默认为0</p>
<p>endIndex 的值可省略，默认为len(slice)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">s := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div><div class="line">a := s[<span class="number">1</span>:<span class="number">3</span>]            <span class="comment">// a: [1 2],  len: 2,  cap:  4</span></div><div class="line">b := s[:<span class="number">4</span>]             <span class="comment">// b: [0 1 2 3],  len: 4,  cap:  5</span></div><div class="line">c := s[<span class="number">1</span>:]             <span class="comment">// c: [1 2 3 4],  len: 4,  cap:  4</span></div><div class="line">d := s[<span class="number">1</span>:<span class="number">1</span>]            <span class="comment">// d: [],  len: 0,  cap:  4</span></div><div class="line">e := s[:]              <span class="comment">// e: [0 1 2 3 4],  len: 5,  cap:  5</span></div></pre></td></tr></table></figure>
<p>3个参数 slice[beginIndex:endIndex:capIndex]</p>
<p>需要满足条件：0 &lt;= beginIndex &lt;= endIndex &lt;= capIndex &lt;= cap(slice)</p>
<p>新slice的长度：length=(endIndex - beginIndex)</p>
<p>新slice的容量：capacity=(capIndex - beginIndex)</p>
<p>beginIndex的值可省略，默认为0</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">10</span>)</div><div class="line">a := s[<span class="number">9</span>:<span class="number">10</span>:<span class="number">10</span>]        <span class="comment">// a: [0],  len: 1,  cap:  1</span></div><div class="line">b := s[:<span class="number">3</span>:<span class="number">5</span>]           <span class="comment">// b: [0 0 0],  len: 3,  cap:  5</span></div></pre></td></tr></table></figure>
<p>向slice中增加/修改元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">s := []string&#123;&#125;</div><div class="line">s = append(s, &quot;a&quot;)              // 添加一个元素</div><div class="line">s = append(s, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;)    // 添加一列元素</div><div class="line">t = []string&#123;&quot;e&quot;, &quot;f&quot;, &quot;g&quot;&#125;</div><div class="line">s = append(s, t...&#125;             // 添加另一个切片t的所有元素</div><div class="line">s = append(s, t[:2]...&#125;         // 添加另一个切片t的部分元素</div><div class="line">s[0] = &quot;A&quot;                      // 修改切片s的第一个元素</div><div class="line">s[len(s)-1] = &quot;G&quot;               // 修改切片s的最后一个元素</div></pre></td></tr></table></figure>
<p>删除slice中指定的元素</p>
<p>因为slice引用指向底层数组，数组的长度不变元素是不能删除的，所以删除的原理就是排除待删除元素后用其他元素重新构造一个数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteByAppend</span><span class="params">()</span></span> &#123;</div><div class="line">    i := <span class="number">3</span></div><div class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</div><div class="line">    <span class="comment">//delete the fourth element(index is 3), using append</span></div><div class="line">    s = <span class="built_in">append</span>(s[:i], s[i+<span class="number">1</span>:]...)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteByCopy</span><span class="params">()</span></span> &#123;</div><div class="line">    i := <span class="number">3</span></div><div class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</div><div class="line">    <span class="comment">//delete the fourth element(index is 3), using copy</span></div><div class="line">    <span class="built_in">copy</span>(s[i:], s[i+<span class="number">1</span>:])</div><div class="line">    s = s[:<span class="built_in">len</span>(s)<span class="number">-1</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="字典映射-map">字典/映射 Map</span></h4><p>map是引用类型，使用内置函数 make进行初始化，未初始化的map零值为 nil长度为0，并且不能赋值元素</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">avar m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></div><div class="line">m[<span class="number">0</span>] = <span class="number">0</span>                              <span class="comment">// × runtime error: assignment to entry in nil map</span></div><div class="line">fmt.Printf(<span class="string">"type: %T\n"</span>, m)           <span class="comment">// map[int]int</span></div><div class="line">fmt.Printf(<span class="string">"value: %#v\n"</span>, m)         <span class="comment">// map[int]int(nil)</span></div><div class="line">fmt.Printf(<span class="string">"value: %v\n"</span>, m)          <span class="comment">// map[]</span></div><div class="line">fmt.Println(<span class="string">"is nil: "</span>, <span class="literal">nil</span> == m)     <span class="comment">// true</span></div><div class="line">fmt.Println(<span class="string">"length: "</span>, <span class="built_in">len</span>(m))       <span class="comment">// 0，if m is nil, len(m) is zero.</span></div></pre></td></tr></table></figure>
<p>使用内置函数make初始化map</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span> = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</div><div class="line">m[<span class="number">0</span>] = <span class="number">0</span>                              <span class="comment">// 插入或修改元素</span></div><div class="line">fmt.Printf(<span class="string">"type: %T\n"</span>, m)           <span class="comment">// map[int]int</span></div><div class="line">fmt.Printf(<span class="string">"value: %#v\n"</span>, m)         <span class="comment">// map[int]int(0:0)</span></div><div class="line">fmt.Printf(<span class="string">"value: %v\n"</span>, m)          <span class="comment">// map[0:0]</span></div><div class="line">fmt.Println(<span class="string">"is nil: "</span>, <span class="literal">nil</span> == m)     <span class="comment">// false</span></div><div class="line">fmt.Println(<span class="string">"length: "</span>, <span class="built_in">len</span>(m))       <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p>直接赋值初始化map</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;</div><div class="line"><span class="number">0</span>:<span class="number">0</span>,</div><div class="line"><span class="number">1</span>:<span class="number">1</span>,                                  <span class="comment">// 最后的逗号是必须的</span></div><div class="line">&#125;</div><div class="line">n := <span class="keyword">map</span>[<span class="keyword">string</span>]S&#123;</div><div class="line"><span class="string">"a"</span>:S&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,</div><div class="line"><span class="string">"b"</span>:&#123;<span class="number">2</span>,<span class="number">3</span>&#125;,                            <span class="comment">// 类型名称可省略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>map的使用：读取、添加、修改、删除元素</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">m[<span class="number">0</span>] = <span class="number">3</span>                              <span class="comment">// 修改m中key为0的值为3</span></div><div class="line">m[<span class="number">4</span>] = <span class="number">8</span>                              <span class="comment">// 添加到m中key为4值为8</span></div><div class="line">a := n[<span class="string">"a"</span>]                           <span class="comment">// 获取n中key为“a“的值</span></div><div class="line">b, ok := n[<span class="string">"c"</span>]                       <span class="comment">// 取值, 并通过ok(bool)判断key对应的元素是否存在.</span></div><div class="line"><span class="built_in">delete</span>(n, <span class="string">"a"</span>)                        <span class="comment">// 使用内置函数delete删除key为”a“对应的元素.</span></div></pre></td></tr></table></figure>
<h4><span id="结构体-struct">结构体 Struct</span></h4><p>结构体类型struct是一个字段的集合</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> S <span class="keyword">struct</span> &#123;</div><div class="line">	A <span class="keyword">int</span></div><div class="line">	B, c <span class="keyword">string</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结构体初始化通过结构体字段的值作为列表来新分配一个结构体。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> s S = S&#123;<span class="number">0</span>, <span class="string">"1"</span>, <span class="string">"2"</span>&#125;</div></pre></td></tr></table></figure>
<p>使用 Name: 语法可以仅列出部分字段(字段名的顺序无关)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> s S = S&#123;B: <span class="string">"1"</span>, A: <span class="number">0</span>&#125;</div></pre></td></tr></table></figure>
<p>结构体是值类型，传递时会复制值，其默认零值不是nil</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a S</div><div class="line"><span class="keyword">var</span> b = S&#123;&#125;</div><div class="line">fmt.Println(a == b)    <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>结构体组合</p>
<p>将一个命名类型作为匿名字段嵌入一个结构体</p>
<p>嵌入匿名字段支持命名类型、命名类型的指针和接口类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">type</span> (</div><div class="line">    A <span class="keyword">struct</span> &#123;</div><div class="line">        v <span class="keyword">int</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 定义结构体B，嵌入结构体A作为匿名字段</span></div><div class="line">    B <span class="keyword">struct</span> &#123;</div><div class="line">        A</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 定义结构体C，嵌入结构体A的指针作为匿名字段</span></div><div class="line">    C <span class="keyword">struct</span> &#123;</div><div class="line">        *A</div><div class="line">    &#125;</div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">setV</span><span class="params">(v <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    a.v = v</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a A)</span> <span class="title">getV</span><span class="params">()</span> <span class="title">int</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> a.v</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b B)</span> <span class="title">getV</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"B"</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *C)</span> <span class="title">getV</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    a := A&#123;&#125;</div><div class="line">    b := B&#123;&#125;    <span class="comment">// 初始化结构体B，其内匿名字段A默认零值是A&#123;&#125;</span></div><div class="line">    c := C&#123;&amp;A&#123;&#125;&#125;    <span class="comment">// 初始化结构体C，其内匿名指针字段*A默认零值是nil，需要初始化赋值</span></div><div class="line">    <span class="built_in">println</span>(a.v)</div><div class="line">    <span class="comment">// 结构体A嵌入B，A内字段自动提升到B</span></div><div class="line">    <span class="built_in">println</span>(b.v)</div><div class="line">    <span class="comment">// 结构体指针*A嵌入C，*A对应结构体内字段自动提升到C</span></div><div class="line">    <span class="built_in">println</span>(c.v)</div><div class="line">    a.setV(<span class="number">3</span>)</div><div class="line">    b.setV(<span class="number">5</span>)</div><div class="line">    c.setV(<span class="number">7</span>)</div><div class="line">    <span class="built_in">println</span>(a.getV(), b.A.getV(), c.A.getV())</div><div class="line">    <span class="built_in">println</span>(a.getV(), b.getV(), c.getV())</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>匿名结构体</p>
<p>匿名结构体声明时省略了type关键字，并且没有名称</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"><span class="keyword">type</span> Integer <span class="keyword">int</span></div><div class="line"><span class="comment">// 声明变量a为空的匿名结构体类型</span></div><div class="line"><span class="keyword">var</span> a <span class="keyword">struct</span>&#123;&#125;</div><div class="line"><span class="comment">// 声明变量b为包含一个字段的匿名结构体类型</span></div><div class="line"><span class="keyword">var</span> b <span class="keyword">struct</span>&#123; x <span class="keyword">int</span> &#125;</div><div class="line"><span class="comment">// 声明变量c为包含两个字段的匿名结构体类型</span></div><div class="line"><span class="keyword">var</span> c <span class="keyword">struct</span> &#123;</div><div class="line">    u <span class="keyword">int</span></div><div class="line">    v <span class="keyword">bool</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    printa(a)</div><div class="line">    b.x = <span class="number">1</span></div><div class="line">    fmt.Printf(<span class="string">"bx: %#v\n"</span>, printb(b))    <span class="comment">// bx: struct &#123; y uint8 &#125;&#123;y:0x19&#125;</span></div><div class="line">    printc(c)</div><div class="line">    <span class="comment">// 声明d为包含3个字段的匿名结构体并初始化部分字段</span></div><div class="line">    d := <span class="keyword">struct</span> &#123;</div><div class="line">        x <span class="keyword">int</span></div><div class="line">        y <span class="keyword">complex64</span></div><div class="line">        z <span class="keyword">string</span></div><div class="line">    &#125;&#123;</div><div class="line">        z: <span class="string">"asdf"</span>,</div><div class="line">        x: <span class="number">111</span>,</div><div class="line">    &#125;</div><div class="line">    d.y = <span class="number">22</span> + <span class="number">333i</span></div><div class="line">    fmt.Printf(<span class="string">"d: %#v\n"</span>, d)    </div><div class="line"><span class="comment">// d: struct &#123; x int; y complex64; z string &#125;&#123;x:111, y:(22+333i), z:"asdf"&#125;</span></div><div class="line">    <span class="comment">// 声明变量e为包含两个字段的匿名结构体类型</span></div><div class="line">    <span class="comment">// 包含1个匿名结构体类型的命名字段和1个命名类型的匿名字段</span></div><div class="line">    e := <span class="keyword">struct</span> &#123;</div><div class="line">        a <span class="keyword">struct</span>&#123; x <span class="keyword">int</span> &#125;</div><div class="line">        <span class="comment">// 结构体组合嵌入匿名字段只支持命名类型</span></div><div class="line">        Integer</div><div class="line">    &#125;&#123;&#125;</div><div class="line">    e.Integer = <span class="number">444</span></div><div class="line">    fmt.Printf(<span class="string">"e: %#v\n"</span>, e)    </div><div class="line"><span class="comment">// e: struct &#123; a struct &#123; x int &#125;; main.Integer &#125;&#123;a:struct &#123; x int &#125;&#123;x:0&#125;, Integer:444&#125;</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 函数参数为匿名结构体类型时，传入参数类型声明必须保持一致</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">printa</span><span class="params">(s <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</div><div class="line">    fmt.Printf(<span class="string">"a: %#v\n"</span>, s)    <span class="comment">// a: struct &#123;&#125;&#123;&#125;</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 函数入参和返回值都支持匿名结构体类型</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">printb</span><span class="params">(s <span class="keyword">struct</span>&#123; x <span class="keyword">int</span> &#125;)</span> <span class="params">(x <span class="keyword">struct</span>&#123; y <span class="keyword">byte</span> &#125;)</span></span> &#123;</div><div class="line">    fmt.Printf(<span class="string">"b: %#v\n"</span>, s)    <span class="comment">// b: struct &#123; x int &#125;&#123;x:1&#125;</span></div><div class="line">    x.y = <span class="number">25</span></div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">printc</span><span class="params">(s <span class="keyword">struct</span> &#123;u <span class="keyword">int</span>; v <span class="keyword">bool</span> &#125;)</span></span> &#123;</div><div class="line">    fmt.Printf(<span class="string">"c: %#v\n"</span>, s)    <span class="comment">// c: struct &#123; u int; v bool &#125;&#123;u:0, v:false&#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="指针-pointer">指针 Pointer</span></h4><p>通过取地址操作符&amp;获取指向值/引用对象的指针。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">1</span></div><div class="line">pi := &amp;i    <span class="comment">// 指向数值的指针</span></div><div class="line">a := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;</div><div class="line">pa := &amp;a    <span class="comment">// 指向引用对象的指针</span></div><div class="line"><span class="keyword">var</span> s *S = &amp;S&#123;<span class="number">0</span>, <span class="string">"1"</span>, <span class="string">"2"</span>&#125;    <span class="comment">// 指向值对象的指针</span></div></pre></td></tr></table></figure>
<p>内置函数new(T)分配了一个零初始化的 T 值，并返回指向它的指针</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i = <span class="built_in">new</span>(<span class="keyword">int</span>)</div><div class="line"><span class="keyword">var</span> s *S = <span class="built_in">new</span>(S)</div></pre></td></tr></table></figure>
<p>使用*读取/修改指针指向的值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    i := <span class="built_in">new</span>(<span class="keyword">int</span>)</div><div class="line">    *i = <span class="number">3</span></div><div class="line">    <span class="built_in">println</span>(i, *i)    <span class="comment">// 0xc208031f80    3</span></div><div class="line">    i = <span class="built_in">new</span>(<span class="keyword">int</span>)</div><div class="line">    <span class="built_in">println</span>(i, *i)    <span class="comment">// 0xc208031f78    0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>指针使用点号来访问结构体字段</p>
<p>结构体字段/方法可以通过结构体指针来访问，通过指针间接的访问是透明的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fmt.Println(s.A)</div><div class="line">fmt.Println((*s).A)</div></pre></td></tr></table></figure>
<p>指针的指针</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line">    <span class="keyword">var</span> p *<span class="keyword">int</span></div><div class="line">    <span class="keyword">var</span> pp **<span class="keyword">int</span></div><div class="line">    <span class="keyword">var</span> ppp ***<span class="keyword">int</span></div><div class="line">    <span class="keyword">var</span> pppp ****<span class="keyword">int</span></div><div class="line">    <span class="built_in">println</span>(i, p, pp, ppp, pppp)    <span class="comment">// 0 0x0 0x0 0x0 0x0</span></div><div class="line">    i, p, pp, ppp, pppp = <span class="number">123</span>, &amp;i, &amp;p, &amp;pp, &amp;ppp</div><div class="line">    <span class="built_in">println</span>(i, p, pp, ppp, pppp)    </div><div class="line"><span class="comment">// 123 0xc208031f68 0xc208031f88 0xc208031f80 0xc208031f78</span></div><div class="line">    <span class="built_in">println</span>(i, *p, **pp, ***ppp, ****pppp)    <span class="comment">// 123 123 123 123 123</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>跨层指针元素的使用</p>
<p>在指针引用多层对象时，指针是针对引用表达式的最后一位元素。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> a</div><div class="line"><span class="keyword">type</span> X <span class="keyword">struct</span> &#123;</div><div class="line">    A Y</div><div class="line">&#125;</div><div class="line"><span class="keyword">type</span> Y <span class="keyword">struct</span> &#123;</div><div class="line">    B Z</div><div class="line">&#125;</div><div class="line"><span class="keyword">type</span> Z <span class="keyword">struct</span> &#123;</div><div class="line">    C <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"a"</span></div><div class="line">    <span class="string">"fmt"</span></div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> x = a.X&#123;&#125;</div><div class="line">    <span class="keyword">var</span> p = &amp;x</div><div class="line">    fmt.Println(<span class="string">"x: "</span>, x)    <span class="comment">// x:  &#123;&#123;&#123;0&#125;&#125;&#125;</span></div><div class="line">    <span class="built_in">println</span>(<span class="string">"p: "</span>, p)    <span class="comment">// p:  0xc208055f20</span></div><div class="line">    fmt.Println(<span class="string">"*p: "</span>, *p)    <span class="comment">// *p:  &#123;&#123;&#123;0&#125;&#125;&#125;</span></div><div class="line">    <span class="built_in">println</span>(<span class="string">"x.A.B.C: "</span>, x.A.B.C)    <span class="comment">// x.A.B.C:  0</span></div><div class="line">    <span class="comment">//  println("*p.A.B.C: ", *p.A.B.C)    // invalid indirect of p.A.B.C (type int)</span></div><div class="line">    <span class="built_in">println</span>(<span class="string">"(*p).A.B.C: "</span>, (*p).A.B.C)    <span class="comment">// (*p).A.B.C:  0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Go的指针没有指针运算，但是 道高一尺，魔高一丈</p>
<p>Go语言中的指针运算</p>
<p>利用unsafe操作未导出变量</p>
<h4><span id="通道-channel">通道 Channel</span></h4><p>channel用于两个goroutine之间传递指定类型的值来同步运行和通讯。</p>
<p>操作符&lt;-用于指定channel的方向，发送或接收。</p>
<p>如果未指定方向，则为双向channel。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> c0 <span class="keyword">chan</span> <span class="keyword">int</span>      <span class="comment">// 可用来发送和接收int类型的值</span></div><div class="line"><span class="keyword">var</span> c1 <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>    <span class="comment">// 可用来发送int类型的值</span></div><div class="line"><span class="keyword">var</span> c2 &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>    <span class="comment">// 可用来接收int类型的值</span></div></pre></td></tr></table></figure>
<p>channel是引用类型，使用make函数来初始化。</p>
<p>未初始化的channel零值是nil，且不能用于发送和接收值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">c0 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)        <span class="comment">// 不带缓冲的int类型channel</span></div><div class="line">c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> *<span class="keyword">int</span>, <span class="number">10</span>)    <span class="comment">// 带缓冲的*int类型指针channel</span></div></pre></td></tr></table></figure>
<p>无缓冲的channe中有值时发送方会阻塞，直到接收方从channel中取出值。</p>
<p>带缓冲的channel在缓冲区已满时发送方会阻塞，直到接收方从channel中取出值。</p>
<p>接收方在channel中无值会一直阻塞。</p>
<p>通过channel发送一个值时，&lt;-作为二元操作符使用，</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c0 &lt;- <span class="number">3</span></div></pre></td></tr></table></figure>
<p>通过channel接收一个值时，&lt;-作为一元操作符使用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">i := &lt;-c1</div></pre></td></tr></table></figure>
<p>关闭channel，只能用于双向或只发送类型的channel</p>
<p>只能由 发送方调用close函数来关闭channel</p>
<p>接收方取出已关闭的channel中发送的值后，后续再从channel中取值时会以非阻塞的方式立即返回channel传递类型的零值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</div><div class="line"><span class="comment">// 发送方，发送值后关闭channel</span></div><div class="line">ch &lt;- <span class="string">"hello"</span></div><div class="line"><span class="built_in">close</span>(ch)</div><div class="line"><span class="comment">// 接收方，取出发送的值</span></div><div class="line">fmt.Println(&lt;-ch)    <span class="comment">// 输出： “hello”</span></div><div class="line"><span class="comment">// 再次从已关闭的channel中取值，返回channel传递类型的零值</span></div><div class="line">fmt.Println(&lt;-ch)    <span class="comment">// 输出： 零值，空字符串“”</span></div><div class="line"><span class="comment">// 接收方判断接收到的零值是由发送方发送的还是关闭channel返回的默认值</span></div><div class="line">s, ok := &lt;-ch</div><div class="line"><span class="keyword">if</span> ok &#123;</div><div class="line">    fmt.Println(<span class="string">"Receive value from sender:"</span>, s)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    fmt.Println(<span class="string">"Get zero value from closed channel"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 向已关闭的通道发送值会产生运行时恐慌panic</span></div><div class="line">ch &lt;- <span class="string">"hi"</span></div><div class="line"><span class="comment">// 再次关闭已经关闭的通道也会产生运行时恐慌panic</span></div><div class="line"><span class="built_in">close</span>(ch)</div></pre></td></tr></table></figure>
<p>使用for range语句依次读取发送到channel的值，直到channel关闭。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 无缓冲和有缓冲的channel的range用法相同</span></div><div class="line">    <span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)    <span class="comment">// make(chan int, 2) 或 make(chan int , 100)</span></div><div class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">            ch &lt;- i</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">close</span>(ch)</div><div class="line">    &#125;()</div><div class="line">    <span class="comment">// channel中无发送值且未关闭时会阻塞</span></div><div class="line">    <span class="keyword">for</span> x := <span class="keyword">range</span> ch &#123;</div><div class="line">        fmt.Println(x)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面方式与for range用法效果相同</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">loop:</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        <span class="keyword">select</span> &#123;</div><div class="line">        <span class="keyword">case</span> x, ok := &lt;-c:</div><div class="line">            <span class="keyword">if</span> !ok &#123;</div><div class="line">                <span class="keyword">break</span> loop</div><div class="line">            &#125;</div><div class="line">            fmt.Println(x)</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4><span id="接口-interface">接口 Interface</span></h4><p>接口类型是由一组方法定义的集合。</p>
<p>接口类型的值可以存放实现这些方法的任何值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</div><div class="line">    Abs() <span class="keyword">float64</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>类型通过实现定义的方法来实现接口， 不需要显式声明实现某接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">float64</span>(-f)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">float64</span>(f)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接口组合</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</div><div class="line">    Read(b []<span class="keyword">byte</span>) (n <span class="keyword">int</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</div><div class="line">    Write(b []<span class="keyword">byte</span>) (n <span class="keyword">int</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 接口ReadWriter组合了Reader和Writer两个接口</span></div><div class="line"><span class="keyword">type</span> ReadWriter <span class="keyword">interface</span> &#123;</div><div class="line">    Reader</div><div class="line">    Writer</div><div class="line">&#125;</div><div class="line"><span class="keyword">type</span> File <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"Read"</span>, <span class="built_in">len</span>(b),<span class="string">"bytes data."</span>)</div><div class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(b)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Write</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"Write"</span>, <span class="built_in">len</span>(b),<span class="string">"bytes data."</span>)</div><div class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(b)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// *File 实现了Read方法和Write方法，所以实现了Reader接口和Writer接口以及组合接口ReadWriter</span></div><div class="line">    <span class="keyword">var</span> f *File = &amp;File&#123;&#125;</div><div class="line">    <span class="keyword">var</span> r Reader = f</div><div class="line">    <span class="keyword">var</span> w Writer = f</div><div class="line">    <span class="keyword">var</span> rw ReadWriter = f</div><div class="line">    bs := []<span class="keyword">byte</span>(<span class="string">"asdf"</span>)</div><div class="line">    r.Read(bs)</div><div class="line">    rw.Read(bs)</div><div class="line">    w.Write(bs)</div><div class="line">    rw.Write(bs)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>内置接口类型error是一个用于表示错误情况的常规接口，其零值nil表示没有错误</p>
<p>所有实现了Error方法的类型都能表示为一个错误</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</div><div class="line">    Error() <span class="keyword">string</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="自定义类型">自定义类型</span></h4><p>Go中支持自定义的类型可基于： 基本类型、数组类型、切片类型、字典类型、函数类型、结构体类型、通道类型、接口类型以及自定义类型的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> (</div><div class="line">    A <span class="keyword">int</span></div><div class="line">    B <span class="keyword">int8</span></div><div class="line">    C <span class="keyword">int16</span></div><div class="line">    D <span class="keyword">rune</span></div><div class="line">    E <span class="keyword">int32</span></div><div class="line">    F <span class="keyword">int64</span></div><div class="line">    G <span class="keyword">uint</span></div><div class="line">    H <span class="keyword">byte</span></div><div class="line">    I <span class="keyword">uint16</span></div><div class="line">    J <span class="keyword">uint32</span></div><div class="line">    K <span class="keyword">uint64</span></div><div class="line">    L <span class="keyword">float32</span></div><div class="line">    M <span class="keyword">float64</span></div><div class="line">    N <span class="keyword">complex64</span></div><div class="line">    O <span class="keyword">complex128</span></div><div class="line">    P <span class="keyword">uintptr</span></div><div class="line">    Q <span class="keyword">bool</span></div><div class="line">    R <span class="keyword">string</span></div><div class="line">    S [<span class="number">3</span>]<span class="keyword">uint8</span></div><div class="line">    T []<span class="keyword">complex128</span></div><div class="line">    U <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">uintptr</span></div><div class="line">    V <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="params">(b <span class="keyword">bool</span>)</span></span></div><div class="line"><span class="function">    <span class="title">W</span> <span class="title">struct</span></span> &#123;a, b <span class="keyword">int</span>&#125;</div><div class="line">    X <span class="keyword">chan</span> <span class="keyword">int</span></div><div class="line">    Y <span class="keyword">interface</span> &#123;&#125;</div><div class="line">    Z A</div><div class="line">)</div></pre></td></tr></table></figure>
<p>以及支持以上所有支持类型的指针类型</p>
<h4><span id="类型别名go-19">类型别名Go 1.9</span></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> (</div><div class="line">     A <span class="keyword">struct</span>&#123;&#125;</div><div class="line">     B <span class="keyword">struct</span>&#123;&#125;  <span class="comment">// 定义两个结构相同的类型A，B</span></div><div class="line">     C = A   <span class="comment">// 定义类型A的别名</span></div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> (</div><div class="line">        a A</div><div class="line">        b B</div><div class="line">        c C</div><div class="line">    )</div><div class="line">    <span class="comment">// 因为类型名不同，所以a和b不是相同类型，此处编译错误</span></div><div class="line">    fmt.Println(a == b) <span class="comment">// invalid operation: a == b (mismatched types A and B)</span></div><div class="line">    fmt.Println(a == c) <span class="comment">// true</span></div><div class="line">    a = C&#123;&#125;</div><div class="line">    c = A&#123;&#125;</div><div class="line">    fmt.Println(c == a) <span class="comment">// true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3><span id="语句-statement">语句 Statement</span></h3><p>分号/括号 ; {</p>
<p>Go是采用语法解析器自动在每行末尾增加分号，所以在写代码的时候可以省略分号。</p>
<p>Go编程中只有几个地方需要手工增加分号：</p>
<p>for循环使用分号把初始化、条件和遍历元素分开。</p>
<p>if/switch的条件判断带有初始化语句时使用分号分开初始化语句与判断语句。</p>
<p>在一行中有多条语句时，需要增加分号。</p>
<p>控制语句(if，for，switch，select)、函数、方法 的左大括号不能单独放在一行， 语法解析器会在大括号之前自动插入一个分号，导致编译错误。</p>
<h4><span id="条件语句-if">条件语句 if</span></h4><p>if语句 小括号 ( )是可选的，而大括号 { } 是必须的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span>)        <span class="comment">// 编译错误.</span></div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line"></div><div class="line"><span class="keyword">if</span> i &lt; <span class="number">0</span>          <span class="comment">// 编译错误.</span></div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line"></div><div class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span>) &#123;      <span class="comment">// 编译通过.</span></div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt; <span class="number">10</span>) &#123;</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> i &lt; <span class="number">0</span> &#123;</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> i &gt; <span class="number">5</span> &amp;&amp; i &lt;= <span class="number">10</span> &#123;</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以在条件之前执行一个简单的语句，由这个语句定义的变量的作用域仅在 if / else if / else 范围之内</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (i := <span class="number">0</span>; i &lt; <span class="number">1</span>) &#123;    <span class="comment">// 编译错误.</span></div><div class="line">     <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> i := <span class="number">0</span>; (i &lt; <span class="number">1</span>) &#123;    <span class="comment">// 编译通过.</span></div><div class="line">     <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> i := <span class="number">0</span>; i &lt; <span class="number">0</span> &#123;      <span class="comment">// 使用gofmt格式化代码会自动移除代码中不必要的小括号( )</span></div><div class="line">     <span class="built_in">println</span>(i)</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> i == <span class="number">0</span> &#123;</div><div class="line">     <span class="built_in">println</span>(i)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">     <span class="built_in">println</span>(i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>if语句作用域范围内定义的变量会覆盖外部同名变量，与方法函数内局部变量覆盖全局变量同理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a, b := <span class="number">0</span>, <span class="number">1</span></div><div class="line"><span class="keyword">if</span> a, b := <span class="number">3</span>, <span class="number">4</span>; a &gt; <span class="number">1</span> &amp;&amp; b &gt; <span class="number">2</span> &#123;</div><div class="line">    <span class="built_in">println</span>(a, b)    <span class="comment">// 3 4</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">println</span>(a, b)        <span class="comment">// 0 1</span></div></pre></td></tr></table></figure>
<p>if判断语句类型断言</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f0</span><span class="params">()</span> <span class="title">int</span></span> &#123;<span class="keyword">return</span> <span class="number">333</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    x := <span class="number">9</span></div><div class="line">    checkType(x)</div><div class="line">    checkType(f0)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkType</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</div><div class="line">    <span class="comment">// 断言传入的x为int类型，并获取值</span></div><div class="line">    <span class="keyword">if</span> i, ok := x.(<span class="keyword">int</span>); ok &#123;</div><div class="line">        <span class="built_in">println</span>(<span class="string">"int: "</span>, i)    <span class="comment">// int:  0</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> f, ok := x.(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span>); <span class="title">ok</span></span> &#123;</div><div class="line">        <span class="built_in">println</span>(<span class="string">"func: "</span>, f())    <span class="comment">// func:  333</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 如果传入x类型为int，则可以直接获取其值</span></div><div class="line">    a := x.(<span class="keyword">int</span>)</div><div class="line">    <span class="built_in">println</span>(a)</div><div class="line">    <span class="comment">// 如果传入x类型不是byte，则会产生恐慌panic</span></div><div class="line">    b := x.(<span class="keyword">byte</span>)</div><div class="line">    <span class="built_in">println</span>(b)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="分支选择-switch">分支选择 switch</span></h4><p>switch存在分支选择对象时，case分支支持单个常量、常量列表</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> x &#123;</div><div class="line"><span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"single const"</span>)</div><div class="line"><span class="keyword">case</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"const list"</span>)</div><div class="line"><span class="keyword">default</span>:</div><div class="line">	<span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>分支选择对象之前可以有一个简单语句，case语句的大括号可以省略</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> x *= <span class="number">2</span>; x &#123;</div><div class="line"><span class="keyword">case</span> <span class="number">4</span>: &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"single const"</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">case</span> <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>: &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"const list"</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">default</span>: &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>switch只有一个简单语句，没有分支选择对象时，case分支支持逻辑表达式语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> x /= <span class="number">3</span>; &#123;</div><div class="line"><span class="keyword">case</span> x == <span class="number">8</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"expression"</span>)</div><div class="line"><span class="keyword">case</span> x &gt;= <span class="number">9</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"expression"</span>)</div><div class="line"><span class="keyword">default</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>switch没有简单语句，没有分支选择对象时，case分支支持逻辑表达式语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> &#123;</div><div class="line"><span class="keyword">case</span> x == <span class="number">10</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"expression"</span>)</div><div class="line"><span class="keyword">case</span> x &gt;= <span class="number">11</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"expression"</span>)</div><div class="line"><span class="keyword">default</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>switch类型分支，只能在switch语句中使用的.(type)获取对象的类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"code.google.com/p/go.crypto/openpgp/errors"</span></div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> (</div><div class="line">        a = <span class="number">0.1</span></div><div class="line">        b = <span class="number">2</span>+<span class="number">3i</span></div><div class="line">        c = <span class="string">"asdf"</span></div><div class="line">        d = [...]<span class="keyword">byte</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</div><div class="line">        e = []<span class="keyword">complex128</span>&#123;<span class="number">1</span>+<span class="number">2i</span>&#125;</div><div class="line">        f = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">uintptr</span>&#123;<span class="string">"a"</span>: <span class="number">0</span>&#125;</div><div class="line">        g = <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;</div><div class="line">        h = <span class="keyword">struct</span> &#123; a, b <span class="keyword">int</span> &#125;&#123;&#125;</div><div class="line">        i = &amp;<span class="keyword">struct</span> &#123;&#125;&#123;&#125;</div><div class="line">        j <span class="keyword">chan</span> <span class="keyword">int</span></div><div class="line">        k <span class="keyword">chan</span> &lt;- <span class="keyword">bool</span></div><div class="line">        l &lt;-<span class="keyword">chan</span> <span class="keyword">string</span></div><div class="line">        m errors.SignatureError</div><div class="line">    )</div><div class="line">    values := []<span class="keyword">interface</span>&#123;&#125;&#123;<span class="literal">nil</span>, a, b, &amp;c, d, e, f, g, &amp;g, h, &amp;h, i, j, k, l, m&#125;</div><div class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> values &#123;</div><div class="line">        typeswitch(v)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">typeswitch</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</div><div class="line">    <span class="comment">// switch x.(type) &#123;    // 不使用类型值时</span></div><div class="line">    <span class="keyword">switch</span> i := x.(<span class="keyword">type</span>) &#123;</div><div class="line">   <span class="keyword">case</span> <span class="literal">nil</span>:</div><div class="line">        fmt.Println(<span class="string">"x is nil"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">int</span>, <span class="keyword">int8</span>, <span class="keyword">int16</span>, <span class="keyword">rune</span>, <span class="keyword">int64</span>, <span class="keyword">uint</span>, <span class="keyword">byte</span>, <span class="keyword">uint16</span>, <span class="keyword">uint32</span>, <span class="keyword">uint64</span>, <span class="keyword">float32</span>, <span class="keyword">float64</span>, <span class="keyword">complex64</span>, <span class="keyword">complex128</span>, <span class="keyword">uintptr</span>, <span class="keyword">bool</span>, <span class="keyword">string</span>:</div><div class="line">        fmt.Printf(<span class="string">"basic type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">case</span> *<span class="keyword">int</span>, *<span class="keyword">int8</span>, *<span class="keyword">int16</span>, *<span class="keyword">rune</span>, *<span class="keyword">int64</span>, *<span class="keyword">uint</span>, *<span class="keyword">byte</span>, *<span class="keyword">uint16</span>, *<span class="keyword">uint32</span>, *<span class="keyword">uint64</span>, *<span class="keyword">float32</span>, *<span class="keyword">float64</span>, *<span class="keyword">complex64</span>, *<span class="keyword">complex128</span>, *<span class="keyword">uintptr</span>, *<span class="keyword">bool</span>, *<span class="keyword">string</span>:</div><div class="line">        fmt.Printf(<span class="string">"basic pointer type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">case</span> [<span class="number">3</span>]<span class="keyword">byte</span>, []<span class="keyword">complex128</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">uintptr</span>:</div><div class="line">        fmt.Printf(<span class="string">"collection type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">case</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="params">(b <span class="keyword">bool</span>)</span>, *<span class="title">func</span><span class="params">()</span>:</span></div><div class="line">        fmt.Printf("function type : %T\n", i)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">struct</span> &#123;a, b <span class="keyword">int</span>&#125;, *<span class="keyword">struct</span> &#123;&#125;:</div><div class="line">        fmt.Printf(<span class="string">"struct type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">chan</span> <span class="keyword">int</span>, <span class="keyword">chan</span> &lt;- <span class="keyword">bool</span>, &lt;-<span class="keyword">chan</span> <span class="keyword">string</span>:</div><div class="line">        fmt.Printf(<span class="string">"channel type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">case</span> error, <span class="keyword">interface</span>&#123;a(); b()&#125;:</div><div class="line">        fmt.Printf(<span class="string">"interface type : %T\n"</span>, i)</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        fmt.Printf(<span class="string">"other type : %T\n"</span>, i)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// output: </span></div><div class="line"><span class="comment">// x is nil</span></div><div class="line"><span class="comment">// basic type : float64</span></div><div class="line"><span class="comment">// basic type : complex128</span></div><div class="line"><span class="comment">// basic pointer type : *string</span></div><div class="line"><span class="comment">// collection type : [3]uint8</span></div><div class="line"><span class="comment">// collection type : []complex128</span></div><div class="line"><span class="comment">// collection type : map[string]uintptr</span></div><div class="line"><span class="comment">// function type : func(int) bool</span></div><div class="line"><span class="comment">// other type : *func(int) bool</span></div><div class="line"><span class="comment">// struct type : struct &#123; a int; b int &#125;</span></div><div class="line"><span class="comment">// other type : *struct &#123; a int; b int &#125;</span></div><div class="line"><span class="comment">// struct type : *struct &#123;&#125;</span></div><div class="line"><span class="comment">// channel type : chan int</span></div><div class="line"><span class="comment">// channel type : chan&lt;- bool</span></div><div class="line"><span class="comment">// channel type : &lt;-chan string</span></div><div class="line"><span class="comment">// interface type : errors.SignatureError</span></div></pre></td></tr></table></figure>
<p>switch中每个case分支默认带有break效果，一个分支执行后就跳出switch，不会自动向下执行其他case。</p>
<p>使用fallthrough强制向下继续执行后面的case代码。</p>
<p>在类型分支中不允许使用fallthrough语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> &#123;</div><div class="line"><span class="keyword">case</span> <span class="literal">false</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"case 1"</span>)</div><div class="line">    <span class="keyword">fallthrough</span></div><div class="line"><span class="keyword">case</span> <span class="literal">true</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"case 2"</span>)</div><div class="line">    <span class="keyword">fallthrough</span></div><div class="line"><span class="keyword">case</span> <span class="literal">false</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"case 3"</span>)</div><div class="line">    <span class="keyword">fallthrough</span></div><div class="line"><span class="keyword">case</span> <span class="literal">true</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"case 4"</span>)</div><div class="line"><span class="keyword">case</span> <span class="literal">false</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"case 5"</span>)</div><div class="line">    <span class="keyword">fallthrough</span></div><div class="line"><span class="keyword">default</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"default case"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 输出：case 2 case 3 case 4</span></div></pre></td></tr></table></figure>
<h4><span id="循环语句-for">循环语句 for</span></h4><p>Go只有一种循环结构：for 循环。</p>
<p>可以让前置(初始化)、中间(条件)、后置(迭代)语句为空，或者全为空。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;...&#125;</div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; &#123;...&#125;      <span class="comment">// 省略迭代语句</span></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; ; i++; &#123;...&#125;       <span class="comment">// 省略条件语句</span></div><div class="line"><span class="keyword">for</span> ; i &lt; <span class="number">10</span>; i++ &#123;...&#125;        <span class="comment">// 省略初始化语句</span></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; ; &#123;...&#125;            <span class="comment">// 省略条件和迭代语句, 分号不能省略</span></div><div class="line"><span class="keyword">for</span> ; i &lt; <span class="number">10</span>; &#123;...&#125;            <span class="comment">// 省略初始化和迭代语句, 分号可省略</span></div><div class="line"><span class="keyword">for</span> ; ; i++ &#123;...&#125;              <span class="comment">// 省略初始化和条件语句, 分号不能省略</span></div><div class="line"><span class="keyword">for</span> i &lt; <span class="number">10</span> &#123;...&#125;</div><div class="line"><span class="keyword">for</span> ; ; &#123;...&#125;                  <span class="comment">// 分号可省略</span></div><div class="line"><span class="keyword">for</span> &#123;...&#125;</div></pre></td></tr></table></figure>
<p>for语句中小括号 ( )是可选的，而大括号 { } 是必须的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)     		<span class="comment">// 编译错误.</span></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; (i &lt; <span class="number">10</span>); i++ &#123;...&#125;     <span class="comment">// 编译通过.</span></div><div class="line"><span class="keyword">for</span> (i &lt; <span class="number">10</span>) &#123;...&#125;                  <span class="comment">// 编译通过.</span></div></pre></td></tr></table></figure>
<p>Go的for each循环for range</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">a := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</div><div class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> a &#123;</div><div class="line">    fmt.Println(k, v)    <span class="comment">// 输出：0 2, 1 3, 2 4, 3 5, 4 6</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> a &#123;</div><div class="line">    fmt.Println(k)    <span class="comment">// 输出：0 1 2 3 4</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span> _ = <span class="keyword">range</span> a &#123;</div><div class="line">    fmt.Println(<span class="string">"print without care about the key and value"</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span> <span class="keyword">range</span> a &#123;</div><div class="line">    fmt.Println(<span class="string">"new syntax – print without care about the key and value"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>循环的继续、中断、跳转</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> s &#123;</div><div class="line">    <span class="keyword">if</span> v == <span class="number">3</span> &#123;</div><div class="line">        <span class="keyword">continue</span>    <span class="comment">// 结束本次循环，进入下一次循环中</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> v == <span class="number">5</span> &#123;</div><div class="line">        <span class="keyword">break</span>    <span class="comment">// 结束整个for循环</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">goto</span> SOMEWHERE    <span class="comment">// 跳转到标签指定的代码处</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>for range只支持遍历数组、数组指针、slice、string、map、channel类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> arr = [...]<span class="keyword">int</span>&#123;<span class="number">33</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">0</span>&#125;</div><div class="line">    <span class="comment">// 遍历数组，取一位值时为索引值</span></div><div class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> arr &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d, "</span>, k)   <span class="comment">// 0, 1, 2, 3,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历数组，取两位值时，第一位为索引值，第二位为元素值</span></div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> arr &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d %d, "</span>, k, v) <span class="comment">// 0 33, 1 22, 2 11, 3 0,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历数组指针，取一位值时为索引值</span></div><div class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> &amp;arr &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d, "</span>, k)   <span class="comment">// 0, 1, 2, 3,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历数组指针，取两位值时，第一位为索引值，第二位为元素值</span></div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> &amp;arr &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d %d, "</span>, k, v) <span class="comment">// 0 33, 1 22, 2 11, 3 0,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="keyword">var</span> slc = []<span class="keyword">byte</span>&#123;<span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>, <span class="number">77</span>&#125;</div><div class="line">    <span class="comment">// 遍历切片，取一位值时为索引值</span></div><div class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> slc &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d, "</span>, k)   <span class="comment">// 0, 1, 2, 3,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历切片，取两位值时，第一位为索引值，第二位为元素值</span></div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> slc &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d %d, "</span>, k, v) <span class="comment">// 0 44, 1 55, 2 66, 3 77,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="keyword">var</span> str = <span class="string">"abc一二3"</span></div><div class="line">    <span class="comment">// 遍历字符串，取一位值时为字节索引值</span></div><div class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> str &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d, "</span>, k)   <span class="comment">// 0, 1, 2, 3, 6, 9,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历字符串，取两位值时，第一位为字节索引值，第二位为Unicode字符</span></div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> str &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d %d %s, "</span>, k, v, <span class="keyword">string</span>(v))   </div><div class="line">      <span class="comment">// 0 97 a, 1 98 b, 2 99 c, 3 19968 一, 6 20108 二, 9 51 3,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="keyword">var</span> mp = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">5</span>:<span class="string">"A"</span>, <span class="number">9</span>:<span class="string">"B"</span>&#125;</div><div class="line">    <span class="comment">// 遍历map，取一位值时为键key</span></div><div class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> mp &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d, "</span>, k)   <span class="comment">// 9, 5,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="comment">// 遍历map，取两位值时，第一位为键key，第二位为元素值value</span></div><div class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> mp &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d %s, "</span>, k, v) <span class="comment">// 5 A, 9 B,</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println()</div><div class="line">    <span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</div><div class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">            ch &lt;- i</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">close</span>(ch)</div><div class="line">    &#125;()</div><div class="line">    <span class="comment">// 遍历channel时，只能取一位值，为发送方发送到channel中的值</span></div><div class="line">    <span class="keyword">for</span> x := <span class="keyword">range</span> ch &#123;</div><div class="line">        fmt.Printf(<span class="string">"%d "</span>, x)    <span class="comment">// 0 1 2 3 4</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="通道选择-select">通道选择 select</span></h4><p>select用于当前goroutine从一组可能的通讯中选择一个进一步处理，</p>
<p>如果任意一个通讯都可以进一步处理，则从中随机选择一个，执行对应的语句，</p>
<p>否则在没有默认分支(default case)时，select语句则会阻塞，直到其中一个通讯完成。</p>
<p>select 的 case 里的操作语句只能是IO操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">ch1, ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>), <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</div><div class="line"><span class="comment">// 因为没有值发送到select中的任一case的channel中，此select将会阻塞</span></div><div class="line"><span class="keyword">select</span> &#123;</div><div class="line"><span class="keyword">case</span> &lt;-ch1:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"channel 1"</span>)</div><div class="line"><span class="keyword">case</span> &lt;-ch2:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"channel 2"</span>)</div><div class="line">&#125;</div><div class="line">ch1, ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>), <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</div><div class="line"><span class="comment">// 因为没有值发送到select中的任一case的channel中，此select将会执行default分支</span></div><div class="line"><span class="keyword">select</span> &#123;</div><div class="line"><span class="keyword">case</span> &lt;-ch1:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"channel 1"</span>)</div><div class="line"><span class="keyword">case</span> &lt;-ch2:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"channel 2"</span>)</div><div class="line"><span class="keyword">default</span>:</div><div class="line">    <span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>select只会执行一次case分支的逻辑，与for组合使用实现多次遍历分支</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        <span class="keyword">select</span> &#123;</div><div class="line">        <span class="keyword">case</span> &lt;-time.Tick(time.Second):</div><div class="line">            <span class="built_in">println</span>(<span class="string">"Tick"</span>)</div><div class="line">        <span class="keyword">case</span> &lt;-time.After(<span class="number">5</span> * time.Second):</div><div class="line">            <span class="built_in">println</span>(<span class="string">"Finish"</span>)</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="built_in">println</span>(<span class="string">"default"</span>)</div><div class="line">            time.Sleep(<span class="number">5e8</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="延迟执行-defer">延迟执行 defer</span></h4><p>defer语句调用函数，将调用的函数加入defer栈，栈中函数在defer所在的主函数返回时执行，执行顺序是先进后出/后进先出。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">defer</span> <span class="built_in">print</span>(<span class="number">0</span>)</div><div class="line">    <span class="keyword">defer</span> <span class="built_in">print</span>(<span class="number">1</span>)</div><div class="line">    <span class="keyword">defer</span> <span class="built_in">print</span>(<span class="number">2</span>)</div><div class="line">    <span class="keyword">defer</span> <span class="built_in">print</span>(<span class="number">3</span>)</div><div class="line">    <span class="keyword">defer</span> <span class="built_in">print</span>(<span class="number">4</span>)</div><div class="line">    <span class="keyword">for</span> i := <span class="number">5</span>; i &lt;= <span class="number">9</span>; i++ &#123;</div><div class="line">        <span class="keyword">defer</span> <span class="built_in">print</span>(i)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 输出：9876543210</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>defer在函数返回后执行，可以修改函数返回值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(f())    <span class="comment">// 返回： 15</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        i *= <span class="number">5</span></div><div class="line">    &#125;()</div><div class="line">    <span class="keyword">return</span> <span class="number">3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>defer用于释放资源</p>
<p>释放锁</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mu.Lock()</div><div class="line"><span class="keyword">defer</span> mu.Unlock()</div></pre></td></tr></table></figure>
<p>关闭channel</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ch &lt;- <span class="string">"hello"</span></div><div class="line"><span class="keyword">defer</span> <span class="built_in">close</span>(ch)</div></pre></td></tr></table></figure>
<p>关闭IO流</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f, err := os.Open(<span class="string">"file.xxx"</span>)</div><div class="line"><span class="keyword">defer</span> f.Close()</div></pre></td></tr></table></figure>
<p>关闭数据库连接</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">db, err := sql.Open(<span class="string">"mysql"</span>,<span class="string">"user:password@tcp(127.0.0.1:3306)/hello"</span>)</div><div class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">    log.Fatal(err)</div><div class="line">&#125;</div><div class="line"><span class="keyword">defer</span> db.Close()</div></pre></td></tr></table></figure>
<p>defer用于恐慌的截获</p>
<p>panic用于产生恐慌，recover用于截获恐慌，recover只能在defer语句中使用, 直接调用recover是无效的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    f()</div><div class="line">    fmt.Println(<span class="string">"main normal..."</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</div><div class="line">            fmt.Println(<span class="string">"catch:"</span>, r)</div><div class="line">        &#125;</div><div class="line">    &#125;()</div><div class="line">    p()</div><div class="line">    fmt.Println(<span class="string">"normal..."</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">p</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">panic</span>(<span class="string">"exception..."</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="跳转语句-goto">跳转语句 goto</span></h4><p>goto用于在一个函数内部运行跳转到指定标签的代码处，不能跳转到其他函数中定义的标签。</p>
<p>goto模拟循环</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    i := <span class="number">0</span></div><div class="line">loop:</div><div class="line">    i++</div><div class="line">    <span class="keyword">if</span> i &lt; <span class="number">5</span> &#123;</div><div class="line">        <span class="keyword">goto</span> loop</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>goto模拟continue，break</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    i, sum := <span class="number">0</span>, <span class="number">0</span></div><div class="line">head:</div><div class="line">    <span class="keyword">for</span> ; i &lt;= <span class="number">10</span>; i++ &#123;</div><div class="line">        <span class="keyword">if</span> i &lt; <span class="number">5</span> &#123;</div><div class="line">            i++    <span class="comment">// 此处必须单独调用一次，因为goto跳转时不会执行for循环的自增语句</span></div><div class="line">            <span class="keyword">goto</span> head    <span class="comment">// continue</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> i &gt; <span class="number">9</span> &#123;</div><div class="line">            <span class="keyword">goto</span> tail    <span class="comment">// break</span></div><div class="line">        &#125;</div><div class="line">        sum += i</div><div class="line">    &#125;</div><div class="line">tail:</div><div class="line">    <span class="built_in">println</span>(sum)    <span class="comment">// 输出：35</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：任何时候都不建议使用goto</p>
<h3><span id="函数-function">函数 Function</span></h3><h4><span id="函数声明-declare">函数声明 Declare</span></h4><p>使用关键字func声明函数，函数可以没有参数或接受多个参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f0</span><span class="params">()</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(a <span class="keyword">int</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">byte</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div></pre></td></tr></table></figure>
<p>在函数参数类型之前使用…声明该参数为可变数量的参数</p>
<p>可变参数只能声明为函数的最后一个参数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span><span class="params">(a ...<span class="keyword">int</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f4</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">bool</span>, c ...<span class="keyword">string</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div></pre></td></tr></table></figure>
<p>函数可以返回任意数量的返回值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f0</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span> <span class="title">int</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>, <span class="string">"A"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函数返回结果参数，可以像变量那样命名和使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> <span class="params">(a <span class="keyword">int</span>, b <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">    a = <span class="number">1</span></div><div class="line">    b = <span class="string">"B"</span></div><div class="line">    <span class="keyword">return</span>    <span class="comment">// 即使return后面没有跟变量，关键字在函数结尾也是必须的</span></div><div class="line">    <span class="comment">// 或者 return a, b</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当两个或多个连续的函数命名参数是同一类型，则除了最后一个类型之外，其他都可以省略</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f0</span><span class="params">(a,b,c <span class="keyword">int</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span> <span class="params">(a,b,c <span class="keyword">int</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(a,b <span class="keyword">int</span>, c,d <span class="keyword">byte</span>)</span> <span class="params">(x,y <span class="keyword">int</span>, z,s <span class="keyword">bool</span>)</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div></pre></td></tr></table></figure>
<h4><span id="函数闭包-closure">函数闭包 Closure</span></h4><p>匿名函数、闭包、函数值</p>
<p>Go中函数作为第一类对象，可以作为值对象赋值给变量</p>
<p>可以在函数体外/内定义匿名函数，命名函数不能嵌套定义到函数体内，只能定义在函数体外</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">type</span> Myfunc <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span></div><div class="line"><span class="function"><span class="title">func</span> <span class="title">f0</span><span class="params">(name <span class="keyword">string</span>)</span></span>&#123;</div><div class="line">    <span class="built_in">println</span>(name)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a = f0</div><div class="line">    a(<span class="string">"hello"</span>)    <span class="comment">// hello</span></div><div class="line">    <span class="keyword">var</span> f1 Myfunc = <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">        <span class="keyword">return</span> i</div><div class="line">    &#125;</div><div class="line">    fmt.Println(f1(<span class="number">3</span>))    <span class="comment">// 3</span></div><div class="line">    <span class="keyword">var</span> f2 <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span> = <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println(f2())     <span class="comment">// 0</span></div><div class="line">    <span class="comment">// 省略部分关键字</span></div><div class="line">    <span class="keyword">var</span> f3 <span class="function"><span class="keyword">func</span><span class="params">()</span> = <span class="title">func</span><span class="params">()</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line">    <span class="keyword">var</span> f4 = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line">    f5 := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;<span class="comment">/*...*/</span>&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4><span id="内建函数-builtin">内建函数 Builtin</span></h4><p><strong>func append</strong></p>
<blockquote>
<p>func append(slice []Type, elems …Type) []Type</p>
</blockquote>
<p>内建函数append将元素追加到切片的末尾。若它有足够的容量，其目标就会重新切片以容纳新的元素。否则，就会分配一个新的基本数组。append返回更新后的切片，因此必须存储追加后的结果。</p>
<p>slice = append(slice, elem1, elem2)</p>
<p>slice = append(slice, anotherSlice…)</p>
<p>作为特例，可以向一个字节切片append字符串，如下：</p>
<p>slice = append([]byte(“hello “), “world”…)</p>
<p><strong>func cap</strong></p>
<blockquote>
<p>func cap(v Type) int</p>
</blockquote>
<p>内建函数cap返回 v 的容量，这取决于具体类型：</p>
<p>数组：v中元素的数量，与 len(v) 相同</p>
<p>数组指针：*v中元素的数量，与len(v) 相同</p>
<p>切片：切片的容量（底层数组的长度）；若 v为nil，cap(v) 即为零</p>
<p>信道：按照元素的单元，相应信道缓存的容量；若v为nil，cap(v)即为零</p>
<p><strong>func close</strong></p>
<blockquote>
<p>func close(c chan&lt;- Type)</p>
</blockquote>
<p>内建函数close关闭信道，该通道必须为双向的或只发送的。它应当只由发送者执行，而不应由接收者执行，其效果是在最后发送的值被接收后停止该通道。在最后的值从已关闭的信道中被接收后，任何对其的接收操作都会无阻塞的成功。对于已关闭的信道，语句：</p>
<p>x, ok := &lt;-c    // ok值为false</p>
<p><strong>func complex</strong></p>
<blockquote>
<p>func complex(r, i FloatType) ComplexType</p>
</blockquote>
<p>使用实部r和虚部i生成一个复数。</p>
<p>c := complex(1, 2)</p>
<p>fmt.Println(c)    // (1+2i)</p>
<p><strong>func copy</strong></p>
<blockquote>
<p>func copy(dst, src []Type) int</p>
</blockquote>
<p>内建函数copy将元素从来源切片复制到目标切片中，也能将字节从字符串复制到字节切片中。copy返回被复制的元素数量，它会是 len(src) 和 len(dst) 中较小的那个。来源和目标的底层内存可以重叠。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a, b, c := []<span class="keyword">byte</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">2</span>), <span class="number">0</span></div><div class="line">fmt.Println(<span class="string">"a:"</span>, a, <span class="string">" b:"</span>, b, <span class="string">" c: "</span>, c)    <span class="comment">// a: [1 2 3]  b: [0 0]  c:  0</span></div><div class="line">c = <span class="built_in">copy</span>(b, a)</div><div class="line">fmt.Println(<span class="string">"a:"</span>, a, <span class="string">" b:"</span>, b, <span class="string">" c: "</span>, c)    <span class="comment">// a: [1 2 3]  b: [1 2]  c:  2</span></div><div class="line">b = <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">5</span>)</div><div class="line">c = <span class="built_in">copy</span>(b, a)</div><div class="line">fmt.Println(<span class="string">"a:"</span>, a, <span class="string">" b:"</span>, b, <span class="string">" c: "</span>, c)    <span class="comment">// a: [1 2 3]  b: [1 2 3 0 0]  c:  3</span></div><div class="line">s := <span class="string">"ABCD"</span></div><div class="line">c = <span class="built_in">copy</span>(b, s)</div><div class="line">fmt.Println(<span class="string">"s:"</span>, s, <span class="string">" b:"</span>, b, <span class="string">" c: "</span>, c)    <span class="comment">// s: ABCD  b: [65 66 67 68 0]  c:  4</span></div></pre></td></tr></table></figure>
<p><strong>func delete</strong></p>
<blockquote>
<p>func delete(m map[Type]Type1, key Type)</p>
</blockquote>
<p>内建函数delete按照指定的键将元素从映射中删除。若m为nil或无此元素，delete不进行操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;</div><div class="line">    <span class="number">0</span>: <span class="string">"A"</span>,</div><div class="line">    <span class="number">1</span>: <span class="string">"B"</span>,</div><div class="line">    <span class="number">2</span>: <span class="string">"C"</span>,</div><div class="line">&#125;</div><div class="line"><span class="built_in">delete</span>(m, <span class="number">1</span>)</div><div class="line">fmt.Println(m)    <span class="comment">// map[2:C 0:A]</span></div><div class="line"><span class="built_in">delete</span>(m, <span class="number">3</span>)    <span class="comment">// 此行代码执行没有任何操作，也不会报错。</span></div></pre></td></tr></table></figure>
<p><strong>func imag</strong></p>
<blockquote>
<p>func imag(c ComplexType) FloatType</p>
</blockquote>
<p>返回复数c的虚部。</p>
<p>c := 2+5i</p>
<p>fmt.Println(imag(c))    // 5</p>
<p><strong>func len</strong></p>
<blockquote>
<p>func len(v Type) int</p>
</blockquote>
<p>内建函数len返回 v 的长度，这取决于具体类型：</p>
<p>数组：v中元素的数量</p>
<p>数组指针：*v中元素的数量（v为nil时panic）</p>
<p>切片、映射：v中元素的数量；若v为nil，len(v)即为零</p>
<p>字符串：v中字节的数量，计算字符数量使用utf8.RuneCountInString()</p>
<p>通道：通道缓存中队列（未读取）元素的数量；若v为 nil，len(v)即为零</p>
<p><strong>func make</strong></p>
<blockquote>
<p>func make(Type, size IntegerType) Type</p>
</blockquote>
<p>内建函数make分配并初始化一个类型为切片、映射、或通道的对象。其第一个实参为类型，而非值。make的返回类型与其参数相同，而非指向它的指针。其具体结果取决于具体的类型：</p>
<p>切片：size指定了其长度。该切片的容量等于其长度。切片支持第二个整数实参可用来指定不同的容量；它必须不小于其长度，因此 make([]int, 0, 10) 会分配一个长度为0，容量为10的切片。</p>
<p>映射：初始分配的创建取决于size，但产生的映射长度为0。size可以省略，这种情况下就会分配一个小的起始大小。</p>
<p>通道：通道的缓存根据指定的缓存容量初始化。若 size为零或被省略，该信道即为无缓存的。</p>
<p><strong>func new</strong></p>
<blockquote>
<p>func new(Type) *Type</p>
</blockquote>
<p>内建函数new分配内存。其第一个实参为类型，而非值。其返回值为指向该类型的新分配的零值的指针。</p>
<p><strong>func panic</strong></p>
<blockquote>
<p>func panic(v interface{})</p>
</blockquote>
<p>内建函数panic停止当前Go程的正常执行。当函数F调用panic时，F的正常执行就会立刻停止。F中defer的所有函数先入后出执行后，F返回给其调用者G。G如同F一样行动，层层返回，直到该Go程中所有函数都按相反的顺序停止执行。之后，程序被终止，而错误情况会被报告，包括引发该恐慌的实参值，此终止序列称为恐慌过程。</p>
<p><strong>func print</strong></p>
<blockquote>
<p>func print(args …Type)</p>
</blockquote>
<p>内建函数print以特有的方法格式化参数并将结果写入标准错误，用于自举和调试。</p>
<p><strong>func println</strong></p>
<blockquote>
<p>func println(args …Type)</p>
</blockquote>
<p>println类似print，但会在参数输出之间添加空格，输出结束后换行。</p>
<p><strong>func real</strong></p>
<blockquote>
<p>func real(c ComplexType) FloatType</p>
</blockquote>
<p>返回复数c的实部。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">c := <span class="number">2</span>+<span class="number">5i</span></div><div class="line">fmt.Println(<span class="built_in">real</span>(c))    <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p><strong>func recover</strong></p>
<blockquote>
<p>func recover() interface{}</p>
</blockquote>
<p>内建函数recover允许程序管理恐慌过程中的Go程。在defer的函数中，执行recover调用会取回传至panic调用的错误值，恢复正常执行，停止恐慌过程。若recover在defer的函数之外被调用，它将不会停止恐慌过程序列。在此情况下，或当该Go程不在恐慌过程中时，或提供给panic的实参为nil时，recover就会返回nil。</p>
<p><strong>func init</strong></p>
<p>init函数是用于程序执行前做包的初始化工作的函数</p>
<p>init函数的声明没有参数和返回值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个package或go源文件可以包含零个或多个init函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"init1..."</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"init2..."</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"init3..."</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>init函数被自动调用，在main函数之前执行，不能在其他函数中调用，显式调用会报错该函数未定义。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"init..."</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    init()    <span class="comment">// undefined: init</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所有init函数都会被自动调用，调用顺序如下：</p>
<p>同一个go文件的init函数调用顺序是 从上到下的</p>
<p>同一个package中按go源文件名字符串比较 从小到大顺序调用各文件中的init函数</p>
<p>不同的package，如果不相互依赖的，按照main包中 先import的后调用的顺序调用其包中的init函数</p>
<p>如果package存在依赖，则先调用最早被依赖的package中的init函数</p>
<h3><span id="方法-method">方法 Method</span></h3><p>通过指定函数的接收者receiver,将函数绑定到一个类型或类型的指针上,使这个函数成为该类型的方法。</p>
<p>只能对命名类型和命名类型的指针编写方法。</p>
<p>只能在定义命名类型的那个包编写其方法。</p>
<p>不能对接口类型和接口类型的指针编写方法。</p>
<p>方法的接收者receiver是类型的值时，编译器会隐式的生成一个同名方法，其接收者receiver为该类型的指针，反过来却不会。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</div><div class="line">    x, y <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义结构体的方法，'_'表示方法内忽略使用结构体、字段及其他方法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(_ A)</span> <span class="title">echo_A</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"(_ A)"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 同上</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(A)</span> <span class="title">echoA</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"(A)"</span>, s)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义结构体指针的方法，'_'表示方法内忽略使用结构体指针、字段及其他方法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(_ *A)</span> <span class="title">echo_</span>ж<span class="title">A</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"(_ *A)"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 同上</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*A)</span> <span class="title">echo</span>ж<span class="title">A</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"(*A)"</span>, s)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义结构体的方法，方法内可以引用结构体、字段及其他方法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a A)</span> <span class="title">setX</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    a.x = x</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义结构体指针的方法，方法内可以引用结构体、结构体指针、字段及其他方法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">setY</span><span class="params">(y <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    a.y = y</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a A    <span class="comment">// a = A&#123;&#125;</span></div><div class="line">    a.setX(<span class="number">3</span>)</div><div class="line">    a.setY(<span class="number">6</span>)</div><div class="line">    <span class="built_in">println</span>(a.x, a.y) <span class="comment">// 0  6</span></div><div class="line">    a.echo_A()    <span class="comment">// (_ A)</span></div><div class="line">    a.echoA(<span class="string">"a"</span>)    <span class="comment">// (A) a</span></div><div class="line">    a.echo_жA()    <span class="comment">// (_ *A)</span></div><div class="line">    a.echoжA(<span class="string">"a"</span>)    <span class="comment">// (*A) a</span></div><div class="line">    <span class="comment">// 以下是定义在结构体值上的方法原型，通过调用结构体类型上定义的函数，传入结构体的值</span></div><div class="line">    A.echo_A(a)    <span class="comment">// (_ A)</span></div><div class="line">    A.echoA(a, <span class="string">"a"</span>)    <span class="comment">// (A) a</span></div><div class="line">    <span class="comment">// A.echo_жA(a)    // A.echo_жA未定义</span></div><div class="line">    <span class="comment">// A.echoжA(a)    //  A.echoжA未定义</span></div><div class="line">    A.setX(a, <span class="number">4</span>)</div><div class="line">    <span class="comment">// A.setY(a, 7)    // A.setY未定义</span></div><div class="line">    <span class="built_in">println</span>(a.x) <span class="comment">// 0</span></div><div class="line">    b := &amp;a</div><div class="line">    b.setX(<span class="number">2</span>)</div><div class="line">    b.setY(<span class="number">5</span>)</div><div class="line">    <span class="built_in">println</span>(b.x, b.y) <span class="comment">// 0  5</span></div><div class="line">    b.echo_A()    <span class="comment">// (_ A)</span></div><div class="line">    b.echoA(<span class="string">"b"</span>)    <span class="comment">// (A) b</span></div><div class="line">    b.echo_жA()    <span class="comment">// (_ *A)</span></div><div class="line">    b.echoжA(<span class="string">"b"</span>)    <span class="comment">// (*A) b</span></div><div class="line">    <span class="comment">// 以下是定义在结构体指针上的方法原型，通过调用结构体类型指针上定义的函数，传入结构体的指针</span></div><div class="line">    (*A).echo_A(b)    <span class="comment">// (_ A)</span></div><div class="line">    (*A).echoA(b, <span class="string">"b"</span>)    <span class="comment">// (A) b</span></div><div class="line">    (*A).echo_жA(b)    <span class="comment">// (_ *A)</span></div><div class="line">    (*A).echoжA(b, <span class="string">"b"</span>)    <span class="comment">// (*A) b</span></div><div class="line">    (*A).setX(b, <span class="number">1</span>)</div><div class="line">    (*A).setY(b, <span class="number">8</span>)</div><div class="line">    <span class="built_in">println</span>(b.x, b.y)    <span class="comment">// 0   8</span></div><div class="line">    <span class="comment">// 调用结构体空指针上的方法，以下注释掉的代码都是空指针错误</span></div><div class="line">    <span class="keyword">var</span> c *A    <span class="comment">// c = nil</span></div><div class="line">    <span class="comment">// c.setX(2)</span></div><div class="line">    <span class="comment">// c.setY(5)</span></div><div class="line">    <span class="comment">// println(c.x, c.y)</span></div><div class="line">    <span class="comment">// c.echo_A()</span></div><div class="line">    <span class="comment">// c.echoA()</span></div><div class="line">    c.echo_жA()    <span class="comment">// (_ *A)</span></div><div class="line">    c.echoжA(<span class="string">"c"</span>)    <span class="comment">// (*A) c</span></div><div class="line">    <span class="comment">// (*A).echo_A(c)</span></div><div class="line">    <span class="comment">// (*A).echoA(c)</span></div><div class="line">    (*A).echo_жA(c)    <span class="comment">// (_ *A)</span></div><div class="line">    (*A).echoжA(c, <span class="string">"c"</span>)    <span class="comment">// (*A) c</span></div><div class="line">    <span class="comment">// (*A).setX(c, 1)</span></div><div class="line">    <span class="comment">// (*A).setY(c, 8)</span></div><div class="line">    <span class="comment">// println(c.x, c.y)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结构体中组合匿名字段时，匿名字段的方法会向外传递，其规则如下：</p>
<p>匿名字段为值类型时：值的方法会传递给结构体的值，指针的方法会传递给结构体的指针；</p>
<p>匿名字段为指针类型时：指针的方法会传递给值和指针；</p>
<p>匿名字段为接口类型时：方法会传递给值和指针；</p>
<p>Go中有匿名函数，但是没有匿名方法</p>
<h3><span id="并发-concurrency">并发 Concurrency</span></h3><p>协程goroutine是由Go运行时环境管理的轻量级线程。</p>
<p>使用关键字go调用一个函数/方法，启动一个新的协程goroutine</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">println</span>(<span class="string">"goroutine:"</span>, i)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</div><div class="line">        <span class="keyword">go</span> say(i)</div><div class="line">    &#125;</div><div class="line">    say(<span class="number">0</span>)</div><div class="line">    time.Sleep(<span class="number">5</span> * time.Second)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主协程goroutine输出0，其他由go启动的几个子协程分别输出1～5</p>
<p>goroutine: 0</p>
<p>goroutine: 1</p>
<p>goroutine: 2</p>
<p>goroutine: 3</p>
<p>goroutine: 4</p>
<p>goroutine: 5</p>
<p>goroutine 在相同的地址空间中运行，因此访问共享内存必须进行同步。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"sync"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"><span class="keyword">var</span> mu sync.Mutex</div><div class="line"><span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> <span class="keyword">range</span> [<span class="number">5</span>]<span class="keyword">byte</span>&#123;&#125; &#123;</div><div class="line">        <span class="keyword">go</span> Add()</div><div class="line">    &#125;</div><div class="line">    time.Sleep(<span class="number">5</span>*time.Second)</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 使用互斥锁防止多个协程goroutine同时修改共享变量</span></div><div class="line">    <span class="comment">// 只能限制同时访问此方法修改变量，在方法外修改则限制是无效的</span></div><div class="line">    mu.Lock()</div><div class="line">    <span class="keyword">defer</span> mu.Unlock()</div><div class="line">    i++</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用通道channel进行同步</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"><span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">byte</span>, <span class="number">1</span>)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> <span class="keyword">range</span> [<span class="number">5</span>]<span class="keyword">byte</span>&#123;&#125; &#123;</div><div class="line">        <span class="keyword">go</span> Add()</div><div class="line">    &#125;</div><div class="line">    time.Sleep(<span class="number">5</span>*time.Second)</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</div><div class="line">    ch &lt;- <span class="number">0</span></div><div class="line">    i++</div><div class="line">    &lt;-ch</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用channel在不同的goroutine之间通信</p>
<p>// 上一个例子只是将channel用作同步开关，稍做修改即可在不同goroutine间通信</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"><span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> <span class="keyword">range</span> [<span class="number">5</span>]<span class="keyword">byte</span>&#123;&#125; &#123;</div><div class="line">        <span class="keyword">go</span> Add()</div><div class="line">    &#125;</div><div class="line">    ch &lt;- i</div><div class="line">    time.Sleep(<span class="number">5</span>*time.Second)</div><div class="line">    i = &lt;-ch</div><div class="line">    <span class="built_in">println</span>(i)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 从channel中接收的值是来自其他goroutine发送的</span></div><div class="line">    x := &lt;-ch</div><div class="line">    x++</div><div class="line">    ch &lt;- x</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3><span id="测试-testing">测试 Testing</span></h3><p>Go中自带轻量级的测试框架testing和自带的go test命令来实现单元测试和基准测试</p>
<p>单元测试 Unit</p>
<p>有如下待测试testgo包，一段简单的求和代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testgo</div><div class="line"><span class="keyword">import</span> <span class="string">"math"</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(min, max <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> min &lt; <span class="number">0</span> || max &lt; <span class="number">0</span> || max &gt; math.MaxInt32 || min &gt; max &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> ; min &lt;= max; min++ &#123;</div><div class="line">        sum += min</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试源文件名必须是_test.go结尾的，go test的时候才会执行到相应的代码</p>
<p>必须import testing包</p>
<p>所有的测试用例函数必须以Test开头</p>
<p>测试用例按照源码中编写的顺序依次执行</p>
<p>测试函数TestXxx()的参数是*testing.T，可以使用该类型来记录错误或者是测试状态</p>
<p>测试格式：func TestXxx (t *testing.T)，Xxx部分可以为任意的字母数字的组合，首字母不能是小写字母[a-z]，例如Testsum是错误的函数名。</p>
<p>函数中通过调用*testing.T的Error，Errorf，FailNow，Fatal，FatalIf方法标注测试不通过，调用Log方法用来记录测试的信息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testgo</div><div class="line"><span class="keyword">import</span> <span class="string">"testing"</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSum</span><span class="params">(t *testing.T)</span></span> &#123;</div><div class="line">	s := Sum(<span class="number">1</span>, <span class="number">0</span>)</div><div class="line">    t.Log(<span class="string">"Sum 1 to 0:"</span>, s)</div><div class="line">    <span class="keyword">if</span> <span class="number">0</span> != s &#123;</div><div class="line">        t.Error(<span class="string">"not equal."</span>)</div><div class="line">    &#125;</div><div class="line">    s = Sum(<span class="number">1</span>, <span class="number">10</span>)</div><div class="line">    t.Log(<span class="string">"Sum 1 to 10:"</span>, s)</div><div class="line">    <span class="keyword">if</span> <span class="number">55</span> != s &#123;</div><div class="line">        t.Error(<span class="string">"not equal."</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在当前包中执行测试：go test -v</p>
<p>=== RUN TestSum</p>
<p>— PASS: TestSum (0.00s)</p>
<p>t0_test.go:7: Sum 1 to 0: 0</p>
<p>t0_test.go:12: Sum 1 to 10: 55</p>
<p>PASS</p>
<p>ok /home/cxy/go/src/testgo 0.004s</p>
<h4><span id="基准测试-benchmark">基准测试 Benchmark</span></h4><p>基准测试 Benchmark用来检测函数/方法的性能</p>
<p>基准测试用例函数必须以Benchmark开头</p>
<p>go test默认不会执行基准测试的函数，需要加上参数-test.bench，语法:-test.bench=”test_name_regex”，例如go test -test.bench=”.*”表示测试全部的基准测试函数</p>
<p>在基准测试用例中，在循环体内使用testing.B.N，使测试可以正常的运行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testgo</div><div class="line"><span class="keyword">import</span> <span class="string">"testing"</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkSum</span><span class="params">(b *testing.B)</span></span> &#123;</div><div class="line">    b.Logf(<span class="string">"Sum 1 to %d: %d\n"</span>, b.N, Sum(<span class="number">1</span>, b.N))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在当前包中执行测试：go test -v -bench .</p>
<p>BenchmarkSum 2000000000 0.91 ns/op</p>
<p>— BENCH: BenchmarkSum</p>
<p>t0_test.go:19: Sum 1 to 1: 1</p>
<p>t0_test.go:19: Sum 1 to 100: 5050</p>
<p>t0_test.go:19: Sum 1 to 10000: 50005000</p>
<p>t0_test.go:19: Sum 1 to 1000000: 500000500000</p>
<p>t0_test.go:19: Sum 1 to 100000000: 5000000050000000</p>
<p>t0_test.go:19: Sum 1 to 2000000000: 2000000001000000000</p>
<p>ok /home/cxy/go/src/testgo 1.922s</p>
<!-- tag: golang-->
</div><div class="tags"><a href="/tags/golang/">golang</a></div><div class="post-nav"><a href="/2017/08/01/c学习笔记/" class="pre">c学习笔记</a><a href="/2017/07/07/sed/" class="next">sed</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/mail/" style="font-size: 15px;">mail</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/24/mailRFC/">mailRFC</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/c学习笔记/">c学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/07/golang语法笔记/">golang语法笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/07/sed/">sed</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/Mycaster" title="github" target="_blank">github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">caster.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>